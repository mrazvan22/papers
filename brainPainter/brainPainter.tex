%% 
%% Copyright 2007, 2008, 2009 Elsevier Ltd
%% 
%% This file is part of the 'Elsarticle Bundle'.
%% ---------------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%% 
%% Template article for Elsevier's document class `elsarticle'
%% with harvard style bibliographic references
%% SP 2008/03/01

%\documentclass[preprint,12pt,authoryear]{elsarticle}

%% Use the option review to obtain double line spacing
%% \documentclass[authoryear,preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times,authoryear]{elsarticle}
%\documentclass[final,1p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,3p,times,authoryear]{elsarticle}
%\documentclass[final,3p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,5p,times,authoryear]{elsarticle}

\documentclass[final,times,twocolumn,authoryear]{elsarticle}
\usepackage[margin=2cm]{geometry}% by courtesy of Mico
            
%% For including figures, graphicx.sty has been loaded in
%% elsarticle.cls. If you prefer to use the old commands
%% please give \usepackage{epsfig}

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
\usepackage{array}
% \usepackage{biblatex}


\usepackage{listings}

\usepackage{graphicx}
\usepackage{placeins}

\usepackage{xpatch}
\usepackage[font=normalfont]{subfig}
% \usepackage{subcaption}

\usepackage{etoolbox,lipsum}
\makeatletter
\patchcmd\@maketitle\@author{\@author \\[\normalbaselineskip] \myfigure}{}{}
\newcommand\myfigure{%
  \makebox[0pt]{
 \includegraphics[height=3cm]{images/cortical-front_0.png}
 \includegraphics[height=3cm]{images/cortical-back_0.png}
 \includegraphics[height=3cm]{images/subcortical_0.png}
} \\[\normalbaselineskip]
  \refstepcounter{figure}\normalfont\textbf{Figure~\thefigure: Some stuff about the teaser}
  \label{fig-teaser}
}
\makeatother


\usepackage[font=normalfont,labelfont=bf]{caption}



%% The amsthm package provides extended theorem environments
%% \usepackage{amsthm}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers.
%% \usepackage{lineno}



\usepackage{etoolbox}
% \patchcmd{<cmd>}{<search>}{<replace>}{<success>}{<failure>}
\patchcmd{\emailauthor}{(#2)}{}{}{}
\patchcmd{\urlauthor}{(#2)}{}{}{}

\journal{}

\makeatletter
\def\ps@pprintTitle{%
 \let\@oddhead\@empty
 \let\@evenhead\@empty
 \def\@oddfoot{}%
 \let\@evenfoot\@oddfoot
 }
\makeatother

\usepackage{xcolor}


\usepackage{hyperref}
\definecolor{links}{HTML}{01368e}
% \hypersetup{colorlinks,linkcolor=links,urlcolor=links}

\makeatletter
\hypersetup{colorlinks=true}
\AtBeginDocument{\@ifpackageloaded{hyperref}
  {\def\@linkcolor{links}
   \def\@anchorcolor{links}
   \def\@citecolor{links}
   \def\@filecolor{links}
   \def\@urlcolor{links}
   \def\@menucolor{links}
   \def\@pagecolor{links}
\begingroup
  \@makeother\`%
  \@makeother\=%
  \edef\x{%
    \edef\noexpand\x{%
      \endgroup
      \noexpand\toks@{%
        \catcode 96=\noexpand\the\catcode`\noexpand\`\relax
        \catcode 61=\noexpand\the\catcode`\noexpand\=\relax
      }%
    }%
    \noexpand\x
  }%
\x
\@makeother\`
\@makeother\=
}{}}
\makeatother


\usepackage{filecontents}

\begin{filecontents*}{bibliography.bib}
@article{jack2010hypothetical,
  title={Hypothetical model of dynamic biomarkers of the Alzheimer's pathological cascade},
  author={Jack Jr, Clifford R and Knopman, David S and Jagust, William J and Shaw, Leslie M and Aisen, Paul S and Weiner, Michael W and Petersen, Ronald C and Trojanowski, John Q},
  journal={The Lancet Neurology},
  volume={9},
  number={1},
  pages={119--128},
  year={2010},
  publisher={Elsevier}
}
@article{scahill2002mapping,
  title={Mapping the evolution of regional atrophy in Alzheimer's disease: unbiased analysis of fluid-registered serial MRI},
  author={Scahill, Rachael I and Schott, Jonathan M and Stevens, John M and Rossor, Martin N and Fox, Nick C},
  journal={Proceedings of the National Academy of Sciences},
  volume={99},
  number={7},
  pages={4703--4707},
  year={2002},
  publisher={National Acad Sciences}
}
@article{seeley2009neurodegenerative,
  title={Neurodegenerative diseases target large-scale human brain networks},
  author={Seeley, William W and Crawford, Richard K and Zhou, Juan and Miller, Bruce L and Greicius, Michael D},
  journal={Neuron},
  volume={62},
  number={1},
  pages={42--52},
  year={2009},
  publisher={Elsevier}
}
@article{migliaccio2015mapping,
  title={Mapping the progression of atrophy in early-and late-onset Alzheimerâ€™s disease},
  author={Migliaccio, Raffaella and Agosta, Federica and Possin, Katherine L and Canu, Elisa and Filippi, Massimo and Rabinovici, Gil D and Rosen, Howard J and Miller, Bruce L and Gorno-Tempini, Maria Luisa},
  journal={Journal of Alzheimer's Disease},
  volume={46},
  number={2},
  pages={351--364},
  year={2015},
  publisher={IOS Press}
}
@article{chard2002brain,
  title={Brain atrophy in clinically early relapsing--remitting multiple sclerosis},
  author={Chard, DT and Griffin, CM and Parker, GJM and Kapoor, R and Thompson, AJ and Miller, DH},
  journal={Brain},
  volume={125},
  number={2},
  pages={327--337},
  year={2002},
  publisher={Oxford University Press}
}
@article{schoonheim2012subcortical,
  title={Subcortical atrophy and cognition: sex effects in multiple sclerosis},
  author={Schoonheim, Menno M and Popescu, Veronica and Lopes, Fernanda C Rueda and Wiebenga, Oliver T and Vrenken, Hugo and Douw, Linda and Polman, Chris H and Geurts, Jeroen JG and Barkhof, Frederik},
  journal={Neurology},
  volume={79},
  number={17},
  pages={1754--1761},
  year={2012},
  publisher={AAN Enterprises}
}
@article{mak2014subcortical,
  title={Subcortical atrophy is associated with cognitive impairment in mild Parkinson disease: a combined investigation of volumetric changes, cortical thickness, and vertex-based shape analysis},
  author={Mak, E and Bergsland, N and Dwyer, MG and Zivadinov, R and Kandiah, N},
  journal={American Journal of Neuroradiology},
  volume={35},
  number={12},
  pages={2257--2264},
  year={2014},
  publisher={Am Soc Neuroradiology}
}
@article{coughlin2015neuroinflammation,
  title={Neuroinflammation and brain atrophy in former NFL players: an in vivo multimodal imaging pilot study},
  author={Coughlin, Jennifer M and Wang, Yuchuan and Munro, Cynthia A and Ma, Shuangchao and Yue, Chen and Chen, Shaojie and Airan, Raag and Kim, Pearl K and Adams, Ashley V and Garcia, Cinthya and others},
  journal={Neurobiology of disease},
  volume={74},
  pages={58--65},
  year={2015},
  publisher={Elsevier}
}
@inproceedings{pieper20043d,
  title={3D Slicer},
  author={Pieper, Steve and Halle, Michael and Kikinis, Ron},
  booktitle={2004 2nd IEEE international symposium on biomedical imaging: nano to macro (IEEE Cat No. 04EX821)},
  pages={632--635},
  year={2004},
  organization={IEEE}
}
@article{fischl2012freesurfer,
  title={FreeSurfer},
  author={Fischl, Bruce},
  journal={Neuroimage},
  volume={62},
  number={2},
  pages={774--781},
  year={2012},
  publisher={Elsevier}
}
@book{penny2011statistical,
  title={Statistical parametric mapping: the analysis of functional brain images},
  author={Penny, William D and Friston, Karl J and Ashburner, John T and Kiebel, Stefan J and Nichols, Thomas E},
  year={2011},
  publisher={Elsevier}
}
@article{desikan2006automated,
  title={An automated labeling system for subdividing the human cerebral cortex on MRI scans into gyral based regions of interest},
  author={Desikan, Rahul S and S{\'e}gonne, Florent and Fischl, Bruce and Quinn, Brian T and Dickerson, Bradford C and Blacker, Deborah and Buckner, Randy L and Dale, Anders M and Maguire, R Paul and Hyman, Bradley T and others},
  journal={Neuroimage},
  volume={31},
  number={3},
  pages={968--980},
  year={2006},
  publisher={Elsevier}
}
@article{destrieux2010automatic,
  title={Automatic parcellation of human cortical gyri and sulci using standard anatomical nomenclature},
  author={Destrieux, Christophe and Fischl, Bruce and Dale, Anders and Halgren, Eric},
  journal={Neuroimage},
  volume={53},
  number={1},
  pages={1--15},
  year={2010},
  publisher={Elsevier}
}
@article{young2018uncovering,
  title={Uncovering the heterogeneity and temporal complexity of neurodegenerative diseases with Subtype and Stage Inference},
  author={Young, Alexandra L and Marinescu, Razvan V and Oxtoby, Neil P and Bocchetta, Martina and Yong, Keir and Firth, Nicholas C and Cash, David M and Thomas, David L and Dick, Katrina M and Cardoso, Jorge and others},
  journal={Nature communications},
  volume={9},
  number={1},
  pages={4273},
  year={2018},
  publisher={Nature Publishing Group}
}
@article{wijeratne2018image,
  title={An image-based model of brain volume biomarker changes in Huntington's disease},
  author={Wijeratne, Peter A and Young, Alexandra L and Oxtoby, Neil P and Marinescu, Razvan V and Firth, Nicholas C and Johnson, Eileanoir B and Mohan, Amrita and Sampaio, Cristina and Scahill, Rachael I and Tabrizi, Sarah J and others},
  journal={Annals of clinical and translational neurology},
  volume={5},
  number={5},
  pages={570--582},
  year={2018},
  publisher={Wiley Online Library}
}
\end{filecontents*}

\usepackage{natbib}
% \addbibresource{bibliography.bib}


\usepackage{tikz}

\begin{document}


\newcommand{\frontFig}{
\begin{center}
\centering

\begin{tikzpicture}
    \node (A) at (0,1.5) {\textbf{INPUT} (.csv)};
\node (A2) at (0,0) {\begin{tabular}{c | c c c c}
 Biomarkers &  hippocampus & inferior & superior & ...\\
  &   & temporal & parietal & ...\\
  \hline
Brain 1 & 0.6 & 2.3 & 1.3 & .. \\
Brain 2 & 1.2 & 0.0 & 3.0 & .. \\
... & ...\\
\end{tabular}};
 \node (B) at (0,-3) {\textbf{OUTPUT}};
 \node (C) at (0,-5) {\includegraphics[height=2.3cm]{images/cortical-front_0.png}
\includegraphics[height=2.3cm]{images/cortical-back_0.png}
\includegraphics[height=2.3cm]{images/subcortical_0.png}
};
 \node (C2) at (C.north) {Brain 1};

    \node (D) at (0,-8.2) {\includegraphics[height=2.3cm]{images/cortical-front_1.png}
\includegraphics[height=2.3cm]{images/cortical-back_1.png}
\includegraphics[height=2.3cm]{images/subcortical_1.png}};
 \node (D2) at (D.north) {Brain 2};

    \draw[thick,->] (A2) -- (B) node[midway,left] {\textbf{\large{BrainPainter}}};
  \end{tikzpicture}
\captionof{figure}{Given a .csv file with biomarkers corresponding to different brain regions, we automatically generate brain images with the cortical surface (left and middle), along with subcortical structures (right).}
\label{fig:mainDiag}
\end{center}
}


\begin{frontmatter}

\title{BrainPainter: A software for the visualisation of brain structures, biomarkers and associated pathological processes}

\ead{razvan@csail.mit.edu}
\ead[url]{https://github.com/mrazvan22/brain-coloring}

\address[mit]{Computer Science and Artificial Intelligence Laboratory, Massachusetts Institute of Technology, Cambridge, USA, MA 02139}
\address[ucl]{Centre for Medical Image Computing, University College London, Gower Street, London, United Kingdom, WC1E 6BT
\frontFig
}

\author[mit,ucl]{R\u{a}zvan V. Marinescu}
\author[ucl]{Daniel C. Alexander}
\author[mit]{Polina Golland}

% \begin{abstract}
% 
% \end{abstract}

% \begin{keyword}
% Brain visualisation \sep
% Neurodegenerative diseases
% \end{keyword}

\end{frontmatter}

%% \linenumbers

%% main text



% \FloatBarrier

\section*{Abstract}
% \label{intro}

We present BrainPainter, a software that automatically generates images of highlighted brain structures given a simple list of numbers corresponding to the output colours of each region. Compared to existing visualisation software (e.g. Freesurfer, SPM, 3d slicer), our software has three key advantages: (1) it does not require the input data to be in a specialised format, allowing it to be used in combination with any neuroimaging analsys tools, (2) it can visualise subcortical structures and (3) it can be used to generate movies showing dynamic processes, e.g. propagation of pathology on the brain, without the need to write additional software code by the user. We highlight three demonstrations of BrainPainter in existing studies: visualisation of (1) the extent of atrophy through interpolation along a user-defined gradient of colours, as well as progression of pathology in (2) cortical and (3) subcortical regions through snapshots. BrainPainter is available online: \url{https://github.com/mrazvan22/brain-coloring}. It is customisable, easy to use, and requires no installation, as it is distributed in a docker container.


\section{Introduction}
\label{intro}


% diagram showing the aim: input numbers and output images

Visualisation of brain structure, function and pathology is crucial for understanding the mechanisms underlying certain neurodegenerative diseases and eases the interpretation of results in brain medical imaging. This is especially important in populations studies, where two or more populations are compared for any group differences in biomarkers derived from e.g. Magnetic Resonance Imaging, Positron Emmission Tomography (PET) or Computer Tomography (CT). However, for traumatic brain injury or rarer neurodegenerative diseases such as Parkinson's disease or Multiple Sclerosis, the visualisation of statistical results is sometimes not performed due to the inability to register images to a common template or lack of robust registration software, hence many studies (\cite{coughlin2015neuroinflammation, mak2014subcortical, schoonheim2012subcortical, chard2002brain}) only report differences between patients and controls in tables or as box plots. 

When alignment to a common population template is possible, e.g. in Alzheimer's disease, excellent 3D visualisation software exists  which allows interactive visualisation of population differences -- e.g. 3D slicer (\cite{pieper20043d}), Freesurfer (\cite{fischl2012freesurfer}) or SPM (\cite{penny2011statistical}). However, such software have several inherent limitations. First, such software (e.g. Freesurfer\footnote{We actually refer to Freeview, which is the visualisation software bundled with Freesurfer}) generally requires inputs in their own data format, which is usually difficult and time-consuming to create without using their pipeline. Secondly, for highlighting complex patterns of pathology, authors need to show multiple slices from the same 3D image (generally from 4 (\cite{seeley2009neurodegenerative}) up to 8 slices (\cite{migliaccio2015mapping}), which ends up taking too much space on the academic paper being publised. While Freesurfer solves this using a cortical surface-based representation that captures all the complexity of pathology patterns in a single image, it cannot visualise subcortical structures. Third, current visualisation software cannot be used to generate a movie showing a dynamic process, e.g. propagation of pathology within the human brain, without considerable effort modifying the software.

We present BrainPainter, a software for easy visualisation of structures, pathology and biomarkers in the brain. As opposed to previous visualisation software, the input data is a simple list of numbers in a .csv file representing colours to be assigned to each brain structure. Secondly, it can visualise patterns on both cortical and subcortical structures using a surface repreentation, removing the need to show multiple slices. Third, the images are generated automatically from pre-defined view-points, and can be used to create a movie showing e.g. the propagation of pathology, without the need to write any extra software code. BrainPainter is open source and available on Github: \url{https://github.com/mrazvan22/brain-coloring}.



%\FloatBarrier
\section{Design}
\label{design}

% diagram showing the Design. what kind of atlases can it take, type of colouring, blender integration


% how does BrianPainter work: takes input csv file, generates images. 
BrainPainter has a very simple workflow. Given an input csv file with biomarkers for each region, it produces high-quality visualisations of cortical and subcortical structures. For this, it uses Blender as a rendering engine, and loads 3D meshes of brain structures which are then coloured according to the input numbers.

% use of blender as rednering engine
BrianPainter uses open-source software Blender as the rendering engine. We chose Blender for two reasons. First, it is open-source, allowing us to distribute it already integrated with BrainPainter, thus requiring no further installation. Secondly, Blender is a powerful 3D graphics software, allowing one to set complex lightining conditions, handle transparency required for the glass-brain and also perform rendering from virtual cameras that can perform fly-overs around the brain. The software also supports a variety of object formats for the brain template, including the popular .obj mesh format.

% ATLASES: DK
The software is able to colour and visualise regions belonging to a pre-defined atlas. Currently, we support the Desikan-Killiany (DK) atlas (\cite{desikan2006automated}) and the Destrieux atlas (\cite{destrieux2010automatic}). Moreover, if the input atlas does not match the DK or Destrieux atlas, the user is able to map the input regions to the DK or Destrieux atlas through a simple mapping in the config.py\footnote{\url{https://github.com/mrazvan22/brain-coloring/blob/master/config.py}} file. 

% customisation

BrainPainter can be easily customised in several ways through the config.py settings file. First of all, the colours assigned to each region can be changed. Moreover, we support interpolating through multiple colors on a gradient, for example from white $\rightarrow$ yellow $\rightarrow$ orange $\rightarrow$ red, as in the example from Fig. \ref{fig:mainDiag}. In this case, the input numbers need to be in the range [0,3], where a value of 1.3 would interpolate between colour 1 (yellow) and color 2 (orange). The resolution and the background colour can also be changed. More complex settings such as the viewing angle can be customised from \verb|blendHelper.py:setCamera()|, while luminosity settings can also be changed from \verb|blendHelper.py:setLamp()|. In the future, we plan to integrate the most important such settings into config.py. 

% Docker containers
In order to remove the need to install Blender and other dependencies, BrainPainter is distributed into a docker container with pre-installed Blender and the python dependencies. 


\section{Use case 1: Extent of pathology}
\label{extent}

BrainPainter can be used to show the severity of pathology within the human brain. This can be highlighted with different colours that can be customised by the user. An example of such an application if shown in Fig. \ref{fig:youngExtent}, where regions with no pathology are coloured in white and very severe regions are coloured in blue. A gradient such as the one on the right can be used to map the colours to some problem-specific labels.

\begin{figure}
 \includegraphics[width=0.49\textwidth]{images/young_3brains}
 \caption{Demonstration of BrainPainter for showing extent of pathology on a vertical bar, where colours towards blue show increased severity. Image courtesy of \cite{young2018uncovering}.}
 \label{fig:youngExtent}
\end{figure}



\section{Use case 2: Temporal progression of pathology}
\label{progression}

Our software can be used to show dynamic processes in the human brain, such as the temporal progression of pathology, as a series of snapshots. For this, one simply needs to provide multiple rows in the input csv, one for each snapshot. Two demonstrations are shown in Fig. \ref{fig:youngProg} and Fig. \ref{fig:peter}.

\begin{figure*}[htp]
\centering
 \includegraphics[width=0.8\textwidth, trim=20 0 0 220, clip]{images/young_progression}
 \caption{Demonstration of our software for showing the temporal progression of pathology, as a sequence of snapshot at different stages. Images used by \cite{young2018uncovering}.}
  \label{fig:youngProg}
\end{figure*}

\begin{figure*}[htp]
\centering
% \subfigure{Stage 0\includegraphics[width=0.2\textwidth]{images/ebmhd_pngs/subcortical_stage0.png}}
\subfloat[Stage 0]{
\includegraphics[width=0.2\textwidth,trim=70 0 70 0, clip]{images/ebmhd_pngs/subcortical_stage0.png}}
\subfloat[Stage 3]{
\includegraphics[width=0.2\textwidth,trim=70 0 70 0, clip]{images/ebmhd_pngs/subcortical_stage3.png}}\subfloat[Stage 7]{
\includegraphics[width=0.2\textwidth,trim=70 0 70 0, clip]{images/ebmhd_pngs/subcortical_stage7.png}}\subfloat[Stage 10]{
\includegraphics[width=0.2\textwidth,trim=70 0 70 0, clip]{images/ebmhd_pngs/subcortical_stage10.png}}\subfloat[Stage 13]{
\includegraphics[width=0.2\textwidth,trim=70 0 70 0, clip]{images/ebmhd_pngs/subcortical_stage13.png}}

 \caption{Progression of pathology in subcortical regions within a glass brain, using images generated with our method. Images used by\cite{wijeratne2018image}.}
   \label{fig:peter}
\end{figure*}

\section{Limitations}

Our software has several limitations that can be addressed in future versions. First of all, we currently only support the DK and Destrieux atlases as these were the only 3D meshes available online\footnote{https://brainder.org/research/brain-for-blender/}. Secondly, it can currently only highlight entire regions-of-interest from such an atlas. However, showing fine-grained voxelwise/vertexwise patterns of colouring requires a specialised input format, which the users will need to convert their data to -- for usability, we decided to only enable coloring based on atlases, although future versions can include the ability to highlight fine-grained patterns. Yet another limitation of BrainPainter is that it cannot visualise more complex structures such as white-matter tracts, although we are happy to add such functionality if there is interest for it within the neuroimaging community.


\section{Conclusion}

We presented BrainPainter, an open-source software that can be used to visualise structures, biomarkers and pathologies in the human brain. BrainPainter is easy to use, requires no installation, and accepts input data in a .csv format there each column represents biomarkers in a specific brain region. 

The visualisations generated by BrainPainter can be used to significantly enhance the interpretation of neuroimaging research. The generated images can be easily embedded by researchers into their scientific articles. Moreover, it can also easily generate movies showing dynamic processes, e.g. propagation of pathology, within the human brain. 



\FloatBarrier
\section{Acknowledgements}


RVM was supported by the EPSRC Centre For Doctoral Training in Medical Imaging with grant EP/L016478/1. DCA was supported by EuroPOND, which is an EU Horizon 2020 project, and by EPSRC grants J020990, M006093 and M020533. 



\section*{References}

\bibliographystyle{elsarticle-harv}
\bibliography{bibliography}




\end{document}




\endinput


%%
%% End of file `elsarticle-template-harv.tex'.
